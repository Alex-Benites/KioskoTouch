<app-header-admin></app-header-admin>

<div class="form-container">
  <p class="breadcrumb-title">GESTIÓN DE MENÚS</p>
  <h1 class="form-main-title">Creación de nuevo Menú</h1>

  <form [formGroup]="menuForm" (ngSubmit)="onSubmit()" class="product-form">
    <div class="form-grid">
      <div class="form-fields-column">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Nombre del menú</mat-label>
          <input matInput formControlName="nombre" placeholder="Ej: Valentine's day">
          <mat-error *ngIf="menuForm.get('nombre')?.hasError('required')">El nombre es requerido.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Descripción del menú</mat-label>
          <textarea matInput formControlName="descripcion" placeholder="Ej: Para que disfrutes con tu pareja" rows="3"></textarea>
          <mat-error *ngIf="menuForm.get('descripcion')?.hasError('required')">La descripción es requerida.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Precio del menú</mat-label>
          <input matInput type="number" formControlName="precio" placeholder="Ej: 9.99">
          <mat-error *ngIf="menuForm.get('precio')?.hasError('required')">El precio es requerido.</mat-error>
          <mat-error *ngIf="menuForm.get('precio')?.hasError('pattern')">Formato de precio inválido (ej: 10 o 10.99).</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Estado del menú</mat-label>
          <mat-select formControlName="disponibilidad">
            <mat-option *ngFor="let disp of estados" [value]="disp.id">{{disp.nombre}}</mat-option>
          </mat-select>
          <mat-error *ngIf="menuForm.get('disponibilidad')?.hasError('required')">{{ disponibilidadError }}</mat-error>
        </mat-form-field>

        <div class="productos-seleccionados">
          <label class="titulo-campo">Productos Seleccionados</label>
          <div class="lista-productos">
            <div class="producto" *ngFor="let producto of productosSeleccionados">
              <img [src]="producto.imagen" alt="{{ producto.nombre }}" class="imagen-producto" />
              <p>{{ producto.nombre }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="image-upload-column">
        <p class="image-upload-label">Imagen del producto</p>
        <div class="image-upload-container" (click)="fileInput.click()">
          <input hidden type="file" #fileInput id="fileInput" (change)="onFileSelected($event)"
            accept="image/png, image/jpeg, image/gif">
          <ng-container *ngIf="!imagePreview; else imagePreviewBlock">
            <img src="assets/admin/ADMIN_27.png" alt="Subir Imagen Icono" class="upload-placeholder-icon">
            <p>Formato de imagen 90x90</p>
          </ng-container>
          <ng-template #imagePreviewBlock>
            <img [src]="imagePreview" alt="Vista previa de la imagen" class="image-preview">
          </ng-template>
        </div>
        <button *ngIf="imagePreview" (click)="eliminarImagen()" class="primary__button delete-image-button" type="button">
          Eliminar
        </button>

        <div class="buscador">
          <label>Buscar producto</label>
          <div class="buscador-input">
            <input type="text" placeholder="Buscar" [(ngModel)]="search" />
            <i class="fas fa-search"></i>
          </div>
        </div>

        <div class="productos-grid">
          <div class="producto-card" *ngFor="let producto of productos">
            <img [src]="producto.imagenUrl" [alt]="producto.nombre" />
            <div class="producto-nombre">{{ producto.nombre }}</div>
            <label class="producto-checkbox">
              <input
                type="checkbox"
                [checked]="estaSeleccionado(producto)"
                (change)="toggleSeleccion(producto)"
              />Seleccionar
            </label>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="primary__button" [disabled]="!menuForm.valid">Crear</button>
      </div>
    </div>
  </form>

</div>

<app-footer-admin [backRoute]="'/administrador/gestion-menus'"></app-footer-admin>
