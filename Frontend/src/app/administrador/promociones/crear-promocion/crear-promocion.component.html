<app-header-admin></app-header-admin>

<div class="form-container">
  <p class="breadcrumb-title">GESTIÓN DE PROMOCIONES</p>
  <h1 class="form-main-title">creación de nueva Promoción</h1>

  <form [formGroup]="promocionForm" (ngSubmit)="onSubmit()" class="promo-form">
    <div class="form-grid">
      <div class="form-fields-column">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Nombre del promocion</mat-label>
          <input
            matInput
            formControlName="nombre"
            placeholder="Ej: Promo Guayaquileña"
          />
          @if (promocionForm.get('nombre')?.hasError('required')) {
          <mat-error>El nombre es requerido.</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Descripción del promocion</mat-label>
          <textarea
            matInput
            formControlName="descripcion"
            placeholder="Ej: Celebra con nosotros las fiestas de Guayaquil"
            rows="3"
          ></textarea>
          @if (promocionForm.get('descripcion')?.hasError('required')) {
          <mat-error>La descripción es requerida.</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Tipo de Promoción</mat-label>
          <mat-select formControlName="tipo">
            @for (cat of categorias; track cat.id) {
            <mat-option [value]="cat.id">{{ cat.nombre }}</mat-option>
            }
          </mat-select>
          @if (promocionForm.get('tipo')?.hasError('required')) {
          <mat-error>El tipo de promoción es requerido.</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Descuento de la promocion</mat-label>
          <input
            matInput
            type="number"
            formControlName="descuento"
            placeholder="Ej: 10%"
          />
          @if (promocionForm.get('descuento')?.hasError('required')) {
          <mat-error>El descuento es requerido.</mat-error>
          } @if (promocionForm.get('descuento')?.hasError('pattern')) {
          <mat-error>Formato de descuento inválido (ej: 10 o 15).</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Codigo promocional</mat-label>
          <input
            matInput
            formControlName="codigo"
            placeholder="Ej: GUAYACO25"
          />
          @if (promocionForm.get('codigo')?.hasError('required')) {
          <mat-error>El codigo promocional es requerido.</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Limite de uso total</mat-label>
          <input
            matInput
            type="number"
            formControlName="limiteTotal"
            placeholder="Ej: 200"
          />
          @if (promocionForm.get('limiteTotal')?.hasError('required')) {
          <mat-error>El limite de uso total es requerido.</mat-error>
          } @if (promocionForm.get('limiteTotal')?.hasError('pattern')) {
          <mat-error>Formato de limite inválido (ej: 10 o 10.99).</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Limite de uso por usuario</mat-label>
          <input
            matInput
            type="number"
            formControlName="limiteUsuario"
            placeholder="Ej: 2"
          />
          @if (promocionForm.get('limiteUsuario')?.hasError('required')) {
          <mat-error>El limite de uso por usuario es requerido.</mat-error>
          } @if (promocionForm.get('limiteUsuario')?.hasError('pattern')) {
          <mat-error>Formato de limite inválido (ej: 1 o 5).</mat-error>
          }
        </mat-form-field>

        <div class="productos-seleccionados">
          <label class="titulo-campo">Productos Seleccionados</label>
          <div class="lista-productos">
            <div
              class="producto"
              *ngFor="let producto of productosSeleccionados"
            >
              <img
                [src]="producto.imagen"
                alt="{{ producto.nombre }}"
                class="imagen-producto"
              />
              <p>{{ producto.nombre }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="image-upload-column">
        <p class="image-upload-label">Imagen de la promoción</p>
        <div class="image-upload-container" (click)="fileInput.click()">
          <input
            hidden
            type="file"
            #fileInput
            id="fileInput"
            (change)="onFileSelected($event)"
            accept="image/png, image/jpeg, image/gif"
          />
          @if (!imagePreview) {
          <img
            src="assets/admin/ADMIN_27.png"
            alt="Subir Imagen Icono"
            class="upload-placeholder-icon"
          />
          <p>Formato de imagen 90x90</p>
          } @else {
          <img
            [src]="imagePreview"
            alt="Vista previa de la imagen"
            class="image-preview"
          />
          }
        </div>
        @if (imagePreview) {
        <button
          (click)="eliminarImagen()"
          class="primary__button delete-image-button"
          type="button"
        >
          Eliminar
        </button>
        }

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Fecha inicial de la promoción</mat-label>
          <input
            matInput
            [matDatepicker]="pickerInicio"
            formControlName="fechaInicio"
            placeholder="Selecciona una fecha"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerInicio"
          ></mat-datepicker-toggle>
          <mat-datepicker #pickerInicio></mat-datepicker>
          @if (promocionForm.get('fechaInicio')?.hasError('required')) {
          <mat-error>La fecha de inicio es requerida.</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Fecha final de la promoción</mat-label>
          <input
            matInput
            [matDatepicker]="pickerFin"
            formControlName="fechaFin"
            placeholder="Selecciona una fecha"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerFin"
          ></mat-datepicker-toggle>
          <mat-datepicker #pickerFin></mat-datepicker>
          @if (promocionForm.get('fechaFin')?.hasError('required')) {
          <mat-error>La fecha de Fin es requerida.</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Estado de la promoción</mat-label>
          <mat-select formControlName="disponibilidad">
            @for (disp of estados; track disp.id) {
            <mat-option [value]="disp.id">{{ disp.nombre }}</mat-option>
            }
          </mat-select>
          @if (promocionForm.get('disponibilidad')?.hasError('required')) {
          <mat-error *ngIf="disponibilidadError">{{
            disponibilidadError
          }}</mat-error>
          }
        </mat-form-field>
      </div>
    </div>

    <div class="form-actions">
      <button
        type="submit"
        class="primary__button"
        [disabled]="!promocionForm.valid"
      >
        Crear
      </button>
    </div>
  </form>
</div>

<app-footer-admin
  [backRoute]="'/administrador/gestion-promociones'"
></app-footer-admin>
