<div class="carrito-page-container">
  <app-publicidad-section
    seccion="carrito"
    altura="200px"
    (publicidadCambio)="onPublicidadCambio($event)">
  </app-publicidad-section>

  <header class="carrito-header">
    <img src="assets/cliente/USUARIO_6.png" alt="Kiosko Go">
  </header>

  <main class="carrito-content">
    <div class="carrito-title-section">
      <span class="carrito-title-label">MEN√ö</span>
      <h2 class="carrito-subtitle">Mi pedido</h2>

    </div>

    <div class="carrito-body" [ngClass]="{'con-productos': productosCarrito.length > 0, 'vacio': productosCarrito.length === 0}">
      <div *ngIf="productosCarrito.length > 0; else carritoVacio" class="productos-lista">
        <div
          *ngFor="let item of productosCarrito; let i = index"
          class="producto-item">

          <div class="producto-seccion-izquierda">
            <div class="producto-barra-lateral"></div>
            <div class="producto-imagen">
              <img [src]="obtenerImagenProducto(item)" [alt]="obtenerNombreProducto(item)">
            </div>
            <div class="producto-info">
              <h3 class="producto-nombre">{{ obtenerNombreProducto(item) }}</h3>
              
              <div *ngIf="obtenerInfoTamano(item)" class="producto-tamano">
                <span class="tamano-info">Tama√±o: {{ obtenerInfoTamano(item) }}</span>
              </div>

              <div *ngIf="item.tipo === 'producto'">
                <div class="producto-personalizaciones" *ngIf="ingredientesCargados && item.personalizacion && item.personalizacion.length > 0">
                  <ng-container *ngFor="let ingr of obtenerPersonalizacionesAgrupadas(item.personalizacion)">
                    <span
                      *ngIf="ingr.accion === 'agregar'"
                      class="personalizacion personalizacion-agregado">
                      Extra: {{ obtenerIngredientePorId(ingr.ingrediente_id).nombre }}<span *ngIf="ingr.cantidad > 1"> x{{ ingr.cantidad }}</span>
                    </span>
                  </ng-container>
                </div>
                
                <div class="producto-personalizaciones" *ngIf="!ingredientesCargados && item.personalizacion && item.personalizacion.length > 0">
                  <span class="personalizacion personalizacion-agregado">
                    Cargando extras...
                  </span>
                </div>
              </div>

              <div *ngIf="item.tipo === 'menu' && item.productos && item.productos.length > 0" class="menu-detalle-lista">
                <span class="menu-detalle-titulo">Incluye:</span>
                <ul>
                  <li *ngFor="let prod of item.productos">
                    {{ prod.nombre }} <span *ngIf="prod.cantidad && prod.cantidad > 1">(x{{ prod.cantidad }})</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="producto-seccion-derecha">
            
            <div class="producto-controles-superiores">
              <div class="cantidad-controles">
                <button
                  class="control-btn disminuir"
                  (click)="disminuirCantidad(i)"
                  [disabled]="item.cantidad <= 1">
                  -
                </button>
                <span class="cantidad-numero">{{ item.cantidad }}</span>
                <button
                  class="control-btn aumentar"
                  (click)="aumentarCantidad(i)">
                  +
                </button>
              </div>

              <div class="precio-eliminar-grupo">
                <div class="producto-precio">
                  <span class="precio-valor">${{ calcularPrecioTotalProducto(item).toFixed(2) }}</span>
                </div>
                <div class="producto-eliminar">
                  <button
                    class="eliminar-btn"
                    (click)="eliminarProducto(i)"
                    title="Eliminar producto">
                    üóëÔ∏è
                  </button>
                </div>
              </div>
            </div>

            <div class="producto-controles-inferiores">
              <button
                *ngIf="item.tipo === 'producto'"
                class="btn-personalizar-below"
                (click)="personalizarProducto(item, i)">
                Personalizar
              </button>
            </div>

          </div>
        </div>
      </div>

      <ng-template #carritoVacio>
        <div class="carrito-vacio">
          <div class="carrito-vacio-icon">üõí</div>
          <h3 class="carrito-vacio-titulo">Tu carrito est√° vac√≠o</h3>
          <p class="carrito-vacio-mensaje">Agrega productos desde el men√∫ para comenzar tu pedido</p>
          <button
            class="btn-ir-menu"
            (click)="volverAlMenu()">
            Ir al Men√∫
          </button>
        </div>
      </ng-template>
    </div>
  </main>

<footer class="order-summary-footer mejorado">
  <div class="order-summary-footer__header">
    <mat-icon class="footer-icon">shopping_cart</mat-icon>
    <h2 class="order-summary-footer__title">Resumen del Pedido</h2>
  </div>
  <div class="order-summary-footer__content">
    <div class="order-summary-footer__details">
      <div class="footer-detail">
        <mat-icon class="footer-detail-icon">attach_money</mat-icon>
        <span class="footer-detail-label">Total:</span>
        <span class="footer-detail-value">${{ totalPedido.toFixed(2) }}</span>
      </div>
      <div class="footer-detail">
        <mat-icon class="footer-detail-icon">fastfood</mat-icon>
        <span class="footer-detail-label">Productos:</span>
        <span class="footer-detail-value">{{ cantidadProductosFooter }}</span>
      </div>
    </div>
    <div class="order-summary-footer__actions">
      <button
        class="secondary__button order-summary-footer__button"
        (click)="volverAlMenu()">
        <mat-icon>arrow_back</mat-icon>
        Seguir Comprando
      </button>
      <button
        class="primary__button order-summary-footer__button carrito-finalizar-btn"
        (click)="finalizarPedido()"
        [disabled]="cantidadProductosFooter === 0">
        <mat-icon>check_circle</mat-icon>
        Finalizar Pedido
      </button>
    </div>
  </div>
</footer>
</div>
