<div class="menu-page-container">
  <app-publicidad-section
    seccion="menu"
    altura="200px"
    (publicidadCambio)="onPublicidadCambio($event)">
  </app-publicidad-section>

  <header class="menu-header">
    <img src="assets/cliente/USUARIO_6.png" alt="Kiosko Go">
  </header>

  @if (estaCargando) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Cargando menú...</p>
    </div>
  }

  @if (hayError) {
    <div class="error-container">
      <p class="error-message">{{ hayError }}</p>
      <button class="retry-button" (click)="recargarDatos()">Reintentar</button>
    </div>
  }

  @if (!estaCargando && !hayError) {
    <div class="menu-content-layout">
      <aside class="category-sidebar">
        @for (categoria of categoriasLista; track categoria.id) {
          <div
            class="category-item"
            [class.active]="categoria.id === categoriaActual?.id"
            (click)="seleccionarCategoria(categoria)">
            <img [src]="obtenerImagenCategoria(categoria)" [alt]="categoria.nombre" class="category-item__icon">
          </div>
        } @empty {
          <p class="no-categories-message">No hay categorías disponibles</p>
        }
      </aside>

      <main class="main-menu-content">
        <div class="menu-title-section">
          <span class="menu-title-label">MENÚ</span>
          <h2 class="menu-category-name">{{ categoriaActual?.nombre || 'Seleccione Categoría' }}</h2>
        </div>

        @if (categoriaActual?.nombre?.toLowerCase() === 'combos') {
          @if (productosActuales.length > 0) {
            <div class="menu-grid">
              @for (menu of productosActuales; track $index) {
                <div class="menu-card">
                  @if (tienePromoBadge(menu)) {
                    <span class="promo-badge" [ngClass]="menu.promoBadgeClass || ''">{{ menu.promoBadge }}</span>
                  }
                  <div class="menu-image-container">
                    @if (menu.imagenUrl) {
                      <img
                        [src]="obtenerImagenProducto(menu)"
                        [alt]="menu.nombre"
                        class="menu-image"
                      />
                    } @else {
                      <div class="no-image-placeholder">
                        <span>Sin imagen</span>
                      </div>
                    }
                  </div>
                  <div class="menu-info">
                    <h3 class="menu-name">{{ menu.nombre }}</h3>
                  </div>
                  <div class="menu-actions">
                    <div class="price-container">
                      @if (tienePromoBadge(menu)) {
                        <span class="price-original">{{ obtenerTextoPrecioGenerico(menu) }}</span>
                        <span class="price-discount">{{ obtenerTextoPrecioConDescuento(menu) }}</span>
                      } @else {
                        <span class="menu-price">{{ obtenerTextoPrecioGenerico(menu) }}</span>
                      }
                    </div>
                    <div class="menu-buttons">
                      <button
                        class="detail-button"
                        (click)="verDetallesMenu(menu, $event)">
                        Ver detalles
                      </button>
                      <button
                        class="product-card__order-button"
                        (click)="agregarProducto(menu, $event)">
                        Ordenar
                      </button>
                    </div>
                  </div>
                </div>
              }
            </div>
          } @else {
            <p class="no-products-message">No hay menús disponibles en esta categoría.</p>
          }
        } @else {
          @if (productosActuales.length > 0) {
            <div class="products-grid">
              @for (producto of productosActuales; track $index) {
                <div class="product-card">
                  @if (tienePromoBadge(producto)) {
                    <span class="promo-badge" [ngClass]="producto.promoBadgeClass || ''">{{ producto.promoBadge }}</span>
                  }
                  <div class="product-card__image-wrapper">
                    <img [src]="obtenerImagenProducto(producto)" [alt]="producto.nombre" class="product-card__image">
                  </div>
                  <div class="product-card__content">
                    <h3 class="product-card__name">{{ producto.nombre }}</h3>
                    <div class="product-card__footer">
                      <div class="price-container">
                        @if (productoTieneTamanos(producto)) {
                          <span class="product-card__price">{{ obtenerTextoPrecio(producto) }}</span>
                        } @else {
                          @if (tienePromoBadge(producto)) {
                            <span class="price-original">{{ obtenerTextoPrecio(producto) }}</span>
                            <span class="price-discount">{{ obtenerTextoPrecioConDescuento(producto) }}</span>
                          } @else {
                            <span class="product-card__price">{{ obtenerTextoPrecio(producto) }}</span>
                          }
                        }
                      </div>
                      <button class="product-card__order-button"
                              (click)="agregarProducto(producto, $event)">
                        Ordenar
                      </button>
                    </div>
                  </div>
                </div>
              }
            </div>
          } @else {
            <p class="no-products-message">No hay productos disponibles en esta categoría.</p>
          }
        }
      </main>
    </div>
  }

<footer class="order-summary-footer mejorado">
  <div class="order-summary-footer__header">
    <mat-icon class="footer-icon">shopping_cart</mat-icon>
    <h2 class="order-summary-footer__title">Mi Orden</h2>
  </div>
  <div class="order-summary-footer__content">
    @if (cantidadItemsSeguro > 0) {
      <div class="order-summary-footer__details">
        <div class="footer-detail">
          <mat-icon class="footer-detail-icon">attach_money</mat-icon>
          <span class="footer-detail-label">Total:</span>
          <span class="footer-detail-value">${{ totalPedidoSeguro.toFixed(2) }}</span>
        </div>
        <div class="footer-detail">
          <mat-icon class="footer-detail-icon">fastfood</mat-icon>
          <span class="footer-detail-label">Productos:</span>
          <span class="footer-detail-value">{{ cantidadItemsSeguro }}</span>
        </div>
      </div>
    } @else {
      <p class="order-summary-footer__empty-message">Tu pedido está vacío</p>
    }
    <div class="order-summary-footer__actions">
      <button class="secondary__button order-summary-footer__button" (click)="cancelarPedido()">
        <mat-icon>cancel</mat-icon>
        Cancelar pedido
      </button>
      <button
        class="primary__button order-summary-footer__button"
        (click)="continuar()"
        [disabled]="!puedeContinuar">
        <mat-icon>arrow_forward</mat-icon>
        {{ textoBotoncontinuar() }}
      </button>
    </div>
  </div>
</footer>

  @if (mostrarLogin) {
    <div class="popup-overlay">
      <div class="popup">
        <button (click)="cerrarPopupLogin()" class="popup-close">×</button>
        <h2>Escanee el siguiente código QR</h2>
        <img src="img/cliente/codigoQR.png" alt="Código QR" />
      </div>
    </div>
  }

