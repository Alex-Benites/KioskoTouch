<div class="instruccion-pago-container" [class]="tipoPago">

  <!-- Banner Promocional Superior -->
  <app-publicidad-section 
    seccion="pago"
    altura="150px"
    (publicidadCambio)="onPublicidadCambio($event)">
  </app-publicidad-section>

  <!-- Contenido Principal -->
  <main class="pago-content">
    <img src="assets/cliente/kiosko_go4k.png" alt="Kiosko Go!" class="kiosko-logo">

    <!-- ‚úÖ ICONO CON SPINNER PARA TARJETA -->
    <div class="pago-icon-wrapper">
      <img [src]="obtenerImagenTipo()" [alt]="obtenerTitulo()" class="pago-icon">
      
      <!-- ‚úÖ SPINNER DE CARGA PARA PAGOS CON TARJETA -->
      @if (tipoPago === 'tarjeta' && procesandoPago) {
        <div class="spinner-overlay">
          <div class="spinner"></div>
        </div>
      }
    </div>

    <h2 class="pago-title">{{ obtenerTitulo() }}</h2>

    <!-- ‚úÖ INFORMACI√ìN DEL PAGO PARA TARJETA -->
    @if (tipoPago === 'tarjeta') {
      <div class="info-pago">
        <!-- Monto Total -->
        <div class="monto-total">
          <span class="etiqueta">Monto a pagar:</span>
          <span class="valor">${{ montoTotal | number:'1.2-2' }}</span>
        </div>
        
        <!-- ‚úÖ ESTADO DEL PAGO -->
        <div class="estado-pago" [ngClass]="'estado-' + estadoPago.estado">
          <div class="estado-icono">
            @switch (estadoPago.estado) {
              @case ('esperando') { <span>‚è≥</span> }
              @case ('procesando') { <span class="icono-girando">üîÑ</span> }
              @case ('exitoso') { <span>‚úÖ</span> }
              @case ('error') { <span>‚ùå</span> }
              @default { <span>üí≥</span> }
            }
          </div>
          <span class="estado-texto">{{ estadoPago.mensaje }}</span>
        </div>

        <!-- ‚úÖ DETALLES DE TRANSACCI√ìN EXITOSA -->
        @if (ultimaTransaccion && estadoPago.estado === 'exitoso') {
          <div class="detalles-transaccion">
            @if (ultimaTransaccion.autorizacion) {
              <div class="detalle-item">
                <span class="etiqueta">Autorizaci√≥n:</span>
                <span class="valor">{{ ultimaTransaccion.autorizacion }}</span>
              </div>
            }
            @if (ultimaTransaccion.referencia) {
              <div class="detalle-item">
                <span class="etiqueta">Referencia:</span>
                <span class="valor">{{ ultimaTransaccion.referencia }}</span>
              </div>
            }
            @if (ultimaTransaccion.numeroTarjeta) {
              <div class="detalle-item">
                <span class="etiqueta">Tarjeta:</span>
                <span class="valor">{{ ultimaTransaccion.numeroTarjeta }}</span>
              </div>
            }
          </div>
        }
      </div>
    }

    <!-- ‚úÖ INFORMACI√ìN DE ORDEN COMPLETADA -->
    @if (tipoPago === 'completado') {
      <div class="orden-info">
        <p class="orden-subtitle">Orden</p>
        <p class="orden-number">#{{ numeroOrden }}</p>
        
        <!-- Mostrar detalles de autorizaci√≥n si est√° disponible -->
        @if (ultimaTransaccion?.autorizacion) {
          <div class="autorizacion-info">
            <p class="autorizacion-label">Autorizaci√≥n:</p>
            <p class="autorizacion-codigo">{{ ultimaTransaccion?.autorizacion }}</p>
          </div>
        }
      </div>
    }

    <!-- ‚úÖ INSTRUCCIONES DIN√ÅMICAS -->
    <p class="pago-instructions">
      {{ obtenerInstrucciones() }}
    </p>

    <!-- ‚úÖ BOTONES CON ESTADOS -->
    <div class="botones-container">
      <button 
        class="pago-button" 
        [disabled]="procesandoPago"
        [ngClass]="{
          'btn-procesando': procesandoPago,
          'btn-error': estadoPago.estado === 'error',
          'btn-exitoso': estadoPago.estado === 'exitoso',
          'btn-esperando': estadoPago.estado === 'esperando'
        }"
        (click)="continuar()">
        {{ obtenerTextoBoton() }}
      </button>

      <!-- ‚úÖ BOT√ìN CANCELAR PARA PAGOS CON TARJETA -->
      @if (tipoPago === 'tarjeta' && estadoPago.estado !== 'exitoso') {
        <button 
          class="btn-cancelar" 
          [disabled]="procesandoPago"
          (click)="cancelarPago()">
          Cancelar
        </button>
      }
    </div>

    <!-- ‚úÖ INDICADOR DE CONECTIVIDAD (opcional) -->
    @if (tipoPago === 'tarjeta') {
      <div class="conectividad-info">
        <span class="conectividad-icono">üì°</span>
        <span class="conectividad-texto">PinPad conectado</span>
      </div>
    }

    <!-- ‚úÖ AGREGAR DESPU√âS DE LA SECCI√ìN info-pago: -->
    @if (tipoPago === 'tarjeta') {
      <div class="info-pago">
        <!-- Informaci√≥n del Pedido -->
        <div class="info-pedido">
          <h3 class="info-titulo">Resumen del Pedido</h3>
          
          <div class="linea-info">
            <span class="etiqueta">Orden:</span>
            <span class="valor">#{{ numeroOrden }}</span>
          </div>
          
          @if (numeroTurno) {
            <div class="linea-info">
              <span class="etiqueta">Turno:</span>
              <span class="valor">{{ numeroTurno }}</span>
            </div>
          }
          
          <div class="linea-info">
            <span class="etiqueta">Productos:</span>
            <span class="valor">{{ cantidadProductos }} items</span>
          </div>
          
          <div class="linea-info">
            <span class="etiqueta">Subtotal:</span>
            <span class="valor">${{ subtotal | number:'1.2-2' }}</span>
          </div>
          
          <div class="linea-info">
            <span class="etiqueta">IVA (15%):</span>
            <span class="valor">${{ iva | number:'1.2-2' }}</span>
          </div>
          
          <div class="linea-total">
            <span class="etiqueta">TOTAL:</span>
            <span class="valor">${{ montoTotal | number:'1.2-2' }}</span>
          </div>
        </div>

        <!-- ... resto del c√≥digo existente ... -->
      </div>
    }
  </main>
</div>