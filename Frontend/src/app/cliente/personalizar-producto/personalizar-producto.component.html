<div class="personalizar-page-container">
  <!-- ‚úÖ Banner Promocional Superior -->
  <div class="promo-banner-top">
    <img src="assets/cliente/USUARIO_5.png" alt="Nuestra Nueva Hamburguesa">
  </div>

  <!-- ‚úÖ Header con logo -->
  <header class="menu-header">
    <img src="assets/cliente/USUARIO_6.png" alt="Kiosko Go">
  </header>

  <!-- ‚úÖ Contenido principal -->
  <main class="personalizacion-content">
    <!-- ‚úÖ Contenedor centrado solo para el producto -->
    <div class="producto-container-centrado">
      <div class="producto-detalle">
        <!-- Imagen del producto -->
        <div class="producto-imagen">
          <img [src]="imagenProducto" [alt]="nombreProducto" class="imagen-principal">
        </div>

        <!-- Informaci√≥n del producto -->
        <div class="producto-info">
          <!-- Categor√≠a del producto -->
          <p class="categoria-label">MEN√ö {{ nombreCategoria.toUpperCase() }}</p>

          <!-- Nombre del producto -->
          <h1 class="producto-nombre">{{ nombreProducto }}</h1>

          <!-- Descripci√≥n del producto -->
          <p class="producto-descripcion">{{ descripcionProducto }}</p>

          <!-- Secci√≥n horizontal con precio a la izquierda y cantidad+bot√≥n a la derecha -->
          <div class="precio-cantidad-horizontal">
            <!-- Precio del producto -->
            <div class="precio-seccion">
              <span class="precio-unitario">${{ precioProducto.toFixed(2) }}</span>
            </div>

            <!-- Contenedor para cantidad (SIN bot√≥n a√±adir) -->
            <div class="cantidad-accion-container">
              <!-- Control de cantidad -->
              <div class="cantidad-control">
                <button
                  class="cantidad-btn disminuir"
                  (click)="disminuirCantidad()"
                  [disabled]="cantidad() <= 1">
                  -
                </button>
                <span class="cantidad-numero">{{ cantidad() }}</span>
                <button
                  class="cantidad-btn aumentar"
                  (click)="aumentarCantidad()">
                  +
                </button>
              </div>

              <!-- ‚úÖ QUITAR: Bot√≥n a√±adir de aqu√≠ -->
              <!-- <button class="boton-anadir-principal" (click)="agregarAlCarrito()">
                A√±adir
              </button> -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚úÖ Secci√≥n de ingredientes con cuadr√≠cula -->
    <div class="ingredientes-container">
      <div class="ingredientes-seccion">
        <h2 class="ingredientes-titulo">Ingredientes</h2>
        <div class="ingredientes-separador"></div>

        <!-- ‚úÖ MOSTRAR loading mientras carga -->
        <div *ngIf="mostrandoCarga()" class="ingredientes-loading">
          <div class="loading-spinner">‚è≥</div>
          <p>Cargando opciones de personalizaci√≥n...</p>
        </div>

        <!-- ‚úÖ MOSTRAR mensaje solo si ya carg√≥ y no hay ingredientes -->
        <div *ngIf="ingredientesCargados() && !tieneIngredientesPersonalizables()" class="sin-ingredientes-message">
          <div class="message-icon">‚ÑπÔ∏è</div>
          <p class="message-text">{{ mensajeSinIngredientes() }}</p>
          <p class="message-subtext">Este producto se agregar√° al carrito con su preparaci√≥n est√°ndar.</p>
        </div>

        <!-- ‚úÖ MOSTRAR ingredientes solo si ya carg√≥ y hay ingredientes -->
        <div *ngIf="ingredientesCargados() && tieneIngredientesPersonalizables()" class="ingredientes-section">
          <h3 class="section-title">ü•ó Personaliza tus ingredientes</h3>
          <p class="section-subtitle">Agrega o quita ingredientes seg√∫n tu preferencia</p>
          
          <!-- Grid de ingredientes -->
          <div class="ingredientes-grid">
            <div
              class="ingrediente-card"
              *ngFor="let ingrediente of ingredientesDisponibles"
              [class.seleccionado]="ingrediente.seleccionado">

              <!-- Imagen del ingrediente -->
              <div class="ingrediente-imagen">
                <img [src]="ingrediente.imagenUrl" [alt]="ingrediente.nombre">
              </div>

              <!-- Informaci√≥n del ingrediente -->
              <div class="ingrediente-info">
                <h4 class="ingrediente-nombre">{{ ingrediente.nombre }}</h4>
                <p class="ingrediente-precio">
                  <!-- ‚úÖ NUEVO: Para ingredientes incluidos -->
                  <span *ngIf="ingrediente.esOriginal" class="precio-incluido">
                    <!-- Mostrar "Sin [ingrediente]" cuando cantidad es 0 -->
                    <span *ngIf="ingrediente.cantidad === 0" class="sin-ingrediente">
                      Sin {{ ingrediente.nombre.toLowerCase() }}
                    </span>
                    <!-- Mostrar "Incluido" cuando cantidad es 1 -->
                    <span *ngIf="ingrediente.cantidad === 1" class="incluido-normal">
                      Incluido
                    </span>
                    <!-- Mostrar cantidad extra cuando es mayor a 1 -->
                    <span *ngIf="ingrediente.cantidad > 1" class="incluido-con-extra">
                      Incluido + {{ ingrediente.cantidad - 1 }} extra 
                      <span class="costo-extra">(+${{ ((ingrediente.cantidad - 1) * (ingrediente.precio || 0)).toFixed(2) }})</span>
                    </span>
                  </span>
                  
                  <!-- ‚úÖ Para ingredientes NO incluidos -->
                  <span *ngIf="!ingrediente.esOriginal" class="precio-adicional">
                    <span *ngIf="ingrediente.cantidad === 0" class="no-seleccionado">
                      +${{ (ingrediente.precio || 0).toFixed(2) }} c/u
                    </span>
                    <span *ngIf="ingrediente.cantidad > 0" class="seleccionado-adicional">
                      {{ ingrediente.cantidad }} x ${{ (ingrediente.precio || 0).toFixed(2) }} = 
                      <span class="total-ingrediente">+${{ (ingrediente.cantidad * (ingrediente.precio || 0)).toFixed(2) }}</span>
                    </span>
                  </span>
                </p>
              </div>

              <!-- ‚úÖ NUEVO: Controles de cantidad -->
              <div class="ingrediente-controles">
                <!-- Bot√≥n disminuir -->
                <button 
                  class="control-btn disminuir"
                  (click)="disminuirIngrediente(ingrediente)"
                  [disabled]="ingrediente.cantidad <= 0">
                  -
                </button>
                
                <!-- Cantidad actual -->
                <span class="cantidad-ingrediente">{{ ingrediente.cantidad }}</span>
                
                <!-- Bot√≥n aumentar -->
                <button 
                  class="control-btn aumentar"
                  (click)="aumentarIngrediente(ingrediente)">
                  +
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- ‚úÖ Footer "Mi Orden" -->
  <footer class="order-summary-footer">
    <h2 class="order-summary-footer__title">Mi Orden</h2>
    <div class="order-summary-footer__content">
      <!-- ‚úÖ USAR los signals del PedidoService (igual que en el men√∫) -->
      <div *ngIf="pedidoService.cantidadItems() > 0; else carritoVacio">
        <div class="order-summary-footer__details">
          <span>Total: ${{ pedidoService.total().toFixed(2) }}</span>
          <span>Productos: {{ pedidoService.cantidadItems() }}</span>
        </div>
      </div>

      <!-- ‚úÖ TEMPLATE cuando no hay productos -->
      <ng-template #carritoVacio>
        <p class="order-summary-footer__empty-message">Tu pedido est√° vac√≠o</p>
      </ng-template>

      <div class="order-summary-footer__actions">
        <button class="primary__button order-summary-footer__button" (click)="cancelarPedido()">
          Cancelar personalizacion
        </button>
        <!-- ‚úÖ CAMBIAR: Reemplazar "Continuar" por "A√±adir" -->
        <button
          class="primary__button order-summary-footer__button boton-anadir-footer"
          (click)="agregarAlCarrito()">
          A√±adir
        </button>
      </div>
    </div>
  </footer>
</div>
